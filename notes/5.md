# **OS Command Injection (CWE-78)**

## **What is OS Command Injection?**

* **Definition (CWE-78):** It is an attack where an attacker executes arbitrary operating system (OS) commands on the hosting server through a vulnerable web application.  
* **Root Cause:** The application takes untrusted, user-supplied data (from forms, cookies, URL parameters, etc.) and directly concatenates it into a string that is then executed by the system shell.  
* **The Goal:** To trick the application into running the attackerâ€™s command instead of the intended one.

### **How the Attack Works**

Attackers use shell metacharacters to chain their malicious command with the legitimate one.

* **Common Metacharacters:** Semicolon (;), Pipe (|), Double Ampersand (&&), and others.  
* **Example (Linux/Unix):** If the application runs ping \-c 1 \[USER\_INPUT\], the attacker supplies 127.0.0.1; ls /etc/ which the shell executes as two separate commands: ping \-c 1 127.0.0.1 **followed by** ls /etc/.

## **Attack Types & Impact**

### **Attack Variants**

| Attack Type | Description | Result |
| :---- | :---- | :---- |
| **In-Band** | The result of the command (e.g., file contents) is returned directly in the web application's response page. | Easy to spot, immediate feedback for the attacker. |
| **Out-of-Band (Blind)** | The command executes but the results are *not* returned in the page. The attacker must use the command to send data elsewhere (e.g., making a DNS lookup or an HTTP request to their own server). | Harder to detect, often requires more complex testing. |

### **Consequences**

* **Full System Control:** An attacker can gain a shell and take complete control of the server.  
* **Data Exfiltration:** Reading, modifying, or deleting sensitive files (e.g., database credentials, user data).  
* **Escalation:** If the vulnerable application runs with high privileges (like a root user), the attacker gains those same high privileges.

## **Mitigation (How to Stop It)**

1. **Avoid Execution:** The strongest defense is to **avoid running OS commands based on user input entirely.** If the functionality can be achieved with a safe, native function within the programming language (e.g., using a library to read a file instead of the cat command), do that instead.  
2. **Use Structured APIs (Safest Method):** Use language-specific functions that execute commands **without** invoking the system shell. These functions treat arguments as distinct data, preventing metacharacters from being interpreted as commands.  
   * *Example (Python):* Use subprocess.run(\['ping', '-c', '1', user\_input\]) instead of subprocess.run('ping \-c 1 ' \+ user\_input, shell=True).  
3. **Input Validation (Allowlist):** If you must use user input, use a strict **allowlist (whitelist)** that only accepts characters and structures you explicitly permit (e.g., only letters and numbers for a filename) and rejects everything else.  
4. **Principle of Least Privilege (PoLP):** Run the web application under a service account with the lowest possible OS privileges. This limits the damage an attacker can do if they successfully exploit the vulnerability.