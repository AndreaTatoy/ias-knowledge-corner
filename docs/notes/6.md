# **SQL Injection (CWE-89)**

## **What is SQL Injection? (CWE-89)**

* **Definition:** An attack where an attacker injects malicious SQL code into an application's input field (like a login form or a URL parameter) to interfere with the intended SQL query.  
* **Root Cause:** The application constructs an SQL command string by **concatenating** untrusted user input directly with the SQL code. The database engine then interprets the user input as part of the executable SQL command.  
* **The Goal:** To alter the logic of the query (e.g., bypass authentication) or extract unauthorized data (e.g., steal entire tables).

### **Classic Vulnerable Pattern Example**

| Language Example (Pseudo-Code) | Injected Query String | Resulting Database Query |
| :---- | :---- | :---- |
| query \= "SELECT \* FROM users WHERE id \= '" \+ user\_id \+ "'" | 105 OR 1=1 \-- | SELECT \* FROM users WHERE id \= '105 OR 1=1 \--' |
| **Explanation** | The attacker uses OR 1=1 (always true) and \-- (SQL comment) to comment out the rest of the query. The database executes the query for **all users**. |  |

## 

## **Attack Impact and Consequences**

SQL Injection is considered one of the most critical vulnerabilities due to its high impact on data assets.

* **Data Breach (Confidentiality):** Exfiltrating sensitive data from the database, such as credit card numbers, personal identifiable information (PII), and passwords.  
* **Data Loss or Corruption (Integrity/Availability):** Modifying or deleting database tables, records, or the entire database structure.  
* **Authentication Bypass:** Using logic flaws (like the OR 1=1 example above) to log in as any user, including an administrator.  
* **System Compromise:** In some databases (like MySQL and PostgreSQL), high-privilege SQL accounts can be used to read or write files to the operating system, potentially leading to **Remote Code Execution (RCE)**.

## **Mitigation (The Strongest Defense)**

The single most effective defense against SQL Injection is using **Prepared Statements**.

### **1\. Prepared Statements (Parameterized Queries)**

* **How it Works:** The application sends the SQL query structure (the command) to the database *first*, and the user input (the data) *second*. The database treats the input as pure data, not as part of the command structure, effectively isolating them.  
* **Result:** Even if an attacker enters ' OR 1=1, the database engine simply searches for a user ID that matches the literal string ' OR 1=1, which will typically return nothing, neutralizing the attack. This is the **Primary Defense**.

### **2\. Principle of Least Privilege (PoLP)**

* Database accounts used by the web application should only have the minimum permissions they need to function.  
* *Example:* If an app only needs to read user profiles, the account should be granted only SELECT permissions. It should **not** have DROP, DELETE, or ALTER permissions.

### **3\. Robust Input Validation (Defense in Depth)**

* **Allowlist Approach:** Reject all input that does not strictly match what is expected. For example, if an input is supposed to be a numeric user ID, check that it is *only* digits and nothing else.